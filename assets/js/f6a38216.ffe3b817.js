"use strict";(self.webpackChunkcasdk_docs=self.webpackChunkcasdk_docs||[]).push([[268],{5328:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var s=t(4848),r=t(8453);const i={},a="0014. Dynamic Data Source Registration",o={id:"architecture/decisions/dynamic-datasource-registration",title:"0014. Dynamic Data Source Registration",description:"Status",source:"@site/docs/architecture/decisions/0014-dynamic-datasource-registration.md",sourceDirName:"architecture/decisions",slug:"/architecture/decisions/dynamic-datasource-registration",permalink:"/docs/architecture/decisions/dynamic-datasource-registration",draft:!1,unlisted:!1,editUrl:"https://github.com/Green-Software-Foundation/carbon-aware-sdk/docs/architecture/decisions/0014-dynamic-datasource-registration.md",tags:[],version:"current",sidebarPosition:14,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"0013. Remove Aggregator layer from the Carbon Aware Architechture",permalink:"/docs/architecture/decisions/remove-aggregator-layer"},next:{title:"0013. Add option to display CLI output in CSV format",permalink:"/docs/architecture/decisions/cli-output-csv"}},c={},d=[{value:"Status",id:"status",level:2},{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"Consequences",id:"consequences",level:2},{value:"Design Considerations",id:"design-considerations",level:2},{value:"Green Impact",id:"green-impact",level:2},{value:"References",id:"references",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"0014-dynamic-data-source-registration",children:"0014. Dynamic Data Source Registration"})}),"\n",(0,s.jsx)(n.h2,{id:"status",children:"Status"}),"\n",(0,s.jsx)(n.p,{children:"Proposed"}),"\n",(0,s.jsx)(n.h2,{id:"context",children:"Context"}),"\n",(0,s.jsx)(n.p,{children:"Decouple the data sources from the SDK into their own NuGet packages will allow for new data sources to be plugged in with minimum configuration and dependency on the existing code base."}),"\n",(0,s.jsx)(n.h2,{id:"decision",children:"Decision"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Decoupling from SDK"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Each data source can be built externally with no dependency on the CarbonAware SDK. This helps achieve single responsibility principle and makes the system extensible."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Increased Maintainability"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Currently, the data source registration code is implemented using a switch statement to register the appropriate data source based on configuration. This can be removed completely and only the data source needed can be imported into the SDK."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Controlled Solution Size"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["All the data sources are part of the current SDK, even if they are not used at runtime. For e.g., if both ",(0,s.jsx)(n.strong,{children:"IEmissions"})," and ",(0,s.jsx)(n.strong,{children:"IForecast"})," interfaces are configured to use WattTime, we need not package the JSON and ElectricityMaps data sources, thereby reducing solution\u2019s size."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Reduction of Security threats"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Having decoupled data sources as packages, it allows us to control potential security threats that can be injected into the overall system, by providing the opportunity to certify them."}),"\n",(0,s.jsx)(n.h2,{id:"consequences",children:"Consequences"}),"\n",(0,s.jsx)(n.p,{children:"Be able to have outsourced Data Sources would benefit the overall system in case there is a large number of those by allowing which one should be part of a solution."}),"\n",(0,s.jsx)(n.h2,{id:"design-considerations",children:"Design Considerations"}),"\n",(0,s.jsxs)(n.p,{children:["Currently Data Sources project is consumed by GSF library using Dependency Injection. Each GSF library handlers have references to ",(0,s.jsx)(n.code,{children:"IForecastDataSource"})," and/or ",(0,s.jsx)(n.code,{children:"IEmissionsDataSource"})," Data Source interfaces.\nTo modify this interaction and to make it more dynamic, these are things that required to be considered:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Public interfaces & Data Records"}),"\n",(0,s.jsx)(n.p,{children:"Data Sources interfaces and Data Records are internal and available only to certain projects (i.e GSF.CarbonAware). This would require to be changed so consumers can dynamically register those and consume them."}),"\n",(0,s.jsxs)(n.p,{children:["Effort Level: ",(0,s.jsx)(n.strong,{children:"Medium"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Packaging"}),"\n",(0,s.jsxs)(n.p,{children:["Current Data Source project is not allowed to be packaged (NuGet package, see ",(0,s.jsx)(n.code,{children:"<IsPackable>"})," property on one of the Data Source projects), which would require how this is going to be done in terms of, what the package contains, versioning and where to publish it."]}),"\n",(0,s.jsxs)(n.p,{children:["Effort Level: ",(0,s.jsx)(n.strong,{children:"Medium"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Load, Register and Instantiate"}),"\n",(0,s.jsxs)(n.p,{children:["Using techniques like ",(0,s.jsx)(n.strong,{children:"Reflection"})," and ",(0,s.jsx)(n.strong,{children:"Assembly Discovery"}),", it would be possible to load Data Sources assemblies and instantiate classes that implements the interfaces that are available.\nAs an example, this could be done via a Data Source class loader"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c#",children:'static Assembly[] GetDataSourceAssemblies()\n{\n        var assemblies = Directory.GetFiles(AppDomain.CurrentDomain.BaseDirectory, "*.dll")\n.Where(x => x.Contains("CarbonAware.DataSource"))\n.Select(x => Assembly.Load(AssemblyName.GetAssemblyName(x)));\n        return assemblies.ToArray();\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Then the consumer could be using Reflection to instantiate the classes interested:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c#",children:'Type providerType = DataSourceAssembly.GetType("CarbonAware.DataSource.ProviderA");\n\nvar theForecast = Activator.CreateInstance(providerType) as IForecastDataSource;\ntheForecast.GetCarbonIntensityForecastAsync(\u2026) // Invoke the interface method.\n'})}),"\n",(0,s.jsx)(n.p,{children:"This responsibility should be part of a new GSF library subsystem."}),"\n",(0,s.jsxs)(n.p,{children:["Effort Level: ",(0,s.jsx)(n.strong,{children:"Medium"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Data Source manifest"}),"\n",(0,s.jsx)(n.p,{children:"Configuration information would be required to be part of the Data Source package, so the GSF handlers can interact with it. Properties like where to locate the assembly, what assembly to load, what classes to interact with (i.e., Builders/Factories) therefore Emissions and Forecast data can be retrieved from GSF handlers. Designing this manifest would help to drive the implementation of the other items."}),"\n",(0,s.jsxs)(n.p,{children:["Effort Level: ",(0,s.jsx)(n.strong,{children:"Large"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"GSF Enhancements"}),"\n",(0,s.jsx)(n.p,{children:"Given the fact the current registration is done using Dependency Injection, GSF library would require to be changed and enhanced to accommodate discovery, how to load the assemblies that are available and that implement Data Sources interfaces. Also understand the configuration that comes from the manifest, in such a way that all the required properties are available."}),"\n",(0,s.jsxs)(n.p,{children:["Effort Level: ",(0,s.jsx)(n.strong,{children:"Medium"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Documentation"}),"\n",(0,s.jsx)(n.p,{children:"Document how to create 3rd party Data Sources, how to package them and how to configure those based on a Data Source manifest."}),"\n",(0,s.jsxs)(n.p,{children:["Effort Level: ",(0,s.jsx)(n.strong,{children:"Medium"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"green-impact",children:"Green Impact"}),"\n",(0,s.jsx)(n.p,{children:"Positive"}),"\n",(0,s.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/nuget/create-packages/creating-a-package-dotnet-cli",children:"Package dotnet CLI"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/nuget/create-packages/sign-a-package",children:"Sign Package"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/dotnet/standard/assembly/",children:"Assemblies in .NET"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var s=t(6540);const r={},i=s.createContext(r);function a(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);